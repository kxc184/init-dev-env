"use strict";(self.webpackChunkworkbench_import_entity=self.webpackChunkworkbench_import_entity||[]).push([[5193],{5193:(e,t,r)=>{r.r(t);var o=r(540),n=r(1730),a=r(607),s=r(7560),i=r(8560),c=r(6085),l=r(425),u=r(5736),d=r(1397),p=r(605),m=r(4962),y=r(5482),h=r(8394),g=r(2054),w=r(5892),f=r.n(w),v=r(6122);var I=r(4490),x=r(7380),C=r(3301),k=r(2465),b=r(8217);const j=async(e,t,r)=>{let o=!1;const n=e?e.map((e=>(e.name===t&&(o=!0),e.name))):[];if(o){const e=b.Modals.getModals(),o=await e.showWarningDialog({uid:`${r}-import-duplicate-warning`,subject:"",message:`${"collection"===r?"A collection":"An environment"} ${t} already exists. What would you like to do?`,options:[{title:"Cancel",isDefaultOnDismiss:!0},{title:"Import as Copy",isPrimary:!0}]});return o&&"Import as Copy"===o.title?(0,x.getDuplicateEntityName)(n,t):"cancel"}return t};var E=r(9461);var N=r(814),S=r(7736),A=r(9907),T=r(2322);const _=f()(i.Z).withConfig({displayName:"workbench-import-entity__ImportListContainer",componentId:"sc-90lswp-0"})(["margin-top:var(--spacing-l);margin-left:var(--spacing-l);margin-right:var(--spacing-l);flex-direction:column;"]),Z=f()(c.Z).withConfig({displayName:"workbench-import-entity__SearchContainer",componentId:"sc-90lswp-1"})(["margin:var(--spacing-xl);"]),O=f()(l.Z).withConfig({displayName:"workbench-import-entity__StyledTable",componentId:"sc-90lswp-2"})(["padding-left:var(--spacing-xl);padding-right:var(--spacing-xl);"]),P=f()(i.Z).withConfig({displayName:"workbench-import-entity__Footer",componentId:"sc-90lswp-3"})(["margin-right:var(--spacing-xl);margin-top:var(--spacing-xl);"]),W=()=>{var e;const t=(()=>{if(window.NAVIGATION_CONTEXT){const t=JSON.parse(window.NAVIGATION_CONTEXT);try{var e;return JSON.parse(v.Base64.decode(null==t||null==(e=t.options)?void 0:e.importData))}catch(e){return{}}}return{}})(),[r,n]=(0,o.useState)(""),{setTabTitle:a}=(0,N.useTabTitleMeta)();(0,o.useEffect)((()=>{a("Import","import")}),[a]);const[i,c]=(0,o.useState)(null!=(e=t.data)?e:[]),[l,w]=(0,o.useState)((0,s.Z)({},i.map((()=>!0)))),[f,b]=(0,o.useState)(!1),W=(0,C.useActiveWorkspaceId)(),{data:D}=(0,I.useCollectionList)({workspaceId:W}),{data:L}=(0,x.useEnvironmentItems)({workspaceId:W}),M=(()=>{const e=(0,C.useActiveWorkspaceId)(),t=(0,I.useCreateNewCollection)(),r=(0,I.useWorkspacePermissions)(e);return async(o,n)=>{if(!r.userCanCreate)return{status:"error",description:"You do not have permission to import a collection."};const a=await j(n,o.name,"collection");if("cancel"===a)return{status:"error",description:"Import cancelled"};o.name=a;try{return await t.mutateAsync({workspaceId:e,requestBody:o}),k.AnalyticsService.addEventV2({category:"http-collection",action:"create",label:"import",value:1}),{status:"success",description:"Collection imported successfully."}}catch(e){return e.name.includes("TimeoutError")?{status:"error",description:"Import request timed out. Please wait for some time or try again."}:{status:"error",description:"Could not import collection. Please try again."}}}})(),F=(()=>{const e=(0,C.useActiveWorkspaceId)(),t=(0,x.useCreateNewEnvironment)(),{data:r}=(0,E.useDataFetch)((0,x.getEnvironmentSidebarPermissionsQuery)(e));return async(o,n)=>{if(null==r||!r.userCanCreateEnvironment)return{status:"error",description:"You do not have permission to import an environment."};const a=await j(n,o.name,"environment");if("cancel"===a)return{status:"error",description:"Import cancelled"};o.name=a;try{return await t.mutateAsync({workspaceId:e,requestBody:o}),k.AnalyticsService.addEventV2({category:"environment",action:"create",label:"import"}),{status:"success",description:"Environment imported successfully."}}catch(e){return e.name.includes("TimeoutError")?{status:"error",description:"Import request timed out. Please wait for some time or try again."}:{status:"error",description:"Could not import environment. Please try again."}}}})(),V=f?[{id:"status",accessor:"status",cellWidth:"2%",Cell:({value:e})=>{if(e){if(e.isLoading)return(0,T.jsx)(u.Z,{});if(e.error)return(0,T.jsx)(d.Z,{content:e.error,children:(0,T.jsx)(y.Z,{"data-testid":"import-status-icon",color:"content-color-error"})});if(e.success)return(0,T.jsx)(d.Z,{content:"Imported successfully",children:(0,T.jsx)(h.Z,{"data-testid":"import-status-icon",color:"content-color-success"})})}return null}},{Header:"Name",accessor:"name",cellWidth:"40%"},{Header:"Import As",accessor:"format",cellWidth:"40%"},{id:"action",accessor:"status",cellWidth:"5%",Cell:e=>{const t=e.row.original;return t.status&&t.status.error?(0,T.jsx)(p.Z,{onClick:()=>B(t),type:"plain",text:"Retry"}):null}}]:[{Header:"Name",accessor:"name"},{Header:"Import As",accessor:"format"}],q=(e,t)=>{const r=[...i],o=r.find((t=>t.path===e));o&&(o.status=t),c(r)},B=async e=>{let t={isLoading:!0};q(e.path,t);try{const r=await(async e=>{{const t=await S.VSCodeCommunicationsService.postMessageToExtensionAsPromise({type:"IMPORT_FILE",payload:{fileDetails:e,userId:(0,A.getUserId)()}});if(t.err)throw new Error(t.val.message);return t.val}})(e),o="postman_collection"===r.type?await M(r.data,null!=D?D:[]):await F(r.data,null!=L?L:[]);"error"===o.status&&(t={isLoading:!1,error:o.description}),"success"===o.status&&(t={isLoading:!1,success:!0})}catch(e){t={isLoading:!1,error:e.message}}finally{q(e.path,t)}};return(0,o.useEffect)((()=>{if(f)for(const e of i)B(e)}),[f]),(0,T.jsxs)(_,{"data-testid":"import-list-container",children:[(0,T.jsx)(m.Z,{type:"h3",text:`Import Elements (${i.length})`}),(0,T.jsx)(Z,{type:"search",value:r,onClear:()=>n(""),onChange:e=>{n(e.target.value)},placeholder:"Search for a file",width:"40%",prefix:(0,T.jsx)(g.Z,{})}),(0,T.jsx)(O,{data:i,columns:V,globalFilter:{filter:r},rowSelected:f?{}:{onSelect:e=>w(e),initialSelectionState:l}}),(0,T.jsx)(P,{justifyContent:"flex-end",children:f?(0,T.jsx)(T.Fragment,{}):(0,T.jsx)(p.Z,{onClick:async()=>{const e=[];for(const t of Object.keys(l))e.push(i[Number(t)]);c(e),b(!0)},type:"primary",text:"Import","data-testid":"import-btn",isDisabled:0===Object.keys(l).length})})]})};var D=r(7376);let L="/";try{var M;L=JSON.parse(null==(M=window)?void 0:M.NAVIGATION_CONTEXT).to}catch(e){}const F=[{path:"/workspace/:workspaceId/import/:importId",element:(0,T.jsx)(W,{}),errorElement:(0,T.jsx)(D.RouteErrorBoundary,{appId:"workbench-import-entity",errorElementId:"workbench-import-entity-route"})}],V=(0,a.createMemoryRouter)(F,{initialEntries:[L],initialIndex:0});function q(){return(0,T.jsx)(a.RouterProvider,{router:V})}(0,k.initializeAnalytics)(),r(7086);const B=document.querySelector("#workbench-import-entity_root");n.render((0,T.jsx)(o.StrictMode,{children:(0,T.jsx)(D.CustomErrorBoundary,{appId:"workbench-import-entity",errorElementId:"global-error-boundary",children:(0,T.jsx)(E.DataFetchCacheProvider,{children:(0,T.jsx)(N.ThemeContextProvider,{children:(0,T.jsx)(q,{})})})})}),B)},7086:(e,t,r)=>{r.r(t)}}]);
//# sourceMappingURL=5193.a2e499b00acbd97a.js.map